<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>1. Obtaining and preparing species occurrence data • RuHere</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="1. Obtaining and preparing species occurrence data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RuHere</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-code"></span> Functions</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/obtaining_data.html">1. Obtaining and preparing occurrence data</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_consistency.html">2. Ensuring spatial consistency</a></li>
    <li><a class="dropdown-item" href="../articles/flagging_records.html">3. Flagging Records Using Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/flagging_records_species_list.html">4. Flagging Records with Specialists' Information</a></li>
    <li><a class="dropdown-item" href="../articles/sampling_bias.html">5. Reducing sampling bias</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wevertonbio/RuHere/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>1. Obtaining and preparing species occurrence data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/wevertonbio/RuHere/blob/main/vignettes/obtaining_data.Rmd" class="external-link"><code>vignettes/obtaining_data.Rmd</code></a></small>
      <div class="d-none name"><code>obtaining_data.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Species occurrence records are the foundation of biodiversity
studies. However, working with multiple data sources (such as GBIF,
SpeciesLink, BIEN, and iDigBio) presents two major challenges: data
acquisition and format standardization. Each database uses different
column names and structures, creating a potential problem for
researchers.</p>
<p>Here, we will use as example the species <em>Araucaria
angustifolia</em>, also known as the Paraná Pine. It is an emblematic
coniferous tree native to the subtropical highlands of Brazil,
Argentina, and Paraguay. Due to historical overexploitation and severe
habitat loss, this species is currently classified as Critically
Endangered (CR) by the IUCN Red List. Its conservation status makes
accurate and comprehensive occurrence data crucial for ecological
modeling, understanding population decline, and guiding reforestation
efforts.</p>
<div class="figure" style="text-align: center">
<img src="vignettes_img/paranapine2.jpeg" class="r-plt" alt="Araucaria forest in southern Brazil" width="80%"><p class="caption">
Araucaria forest in southern Brazil
</p>
</div>
<p>This vignette demonstrates how to configure access credentials,
download occurrence data from multiple sources, standardize and unify
the results, and finally convert them into spatial objects ready for
ecological analysis.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load RuHere package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wevertonbio.github.io/RuHere/">RuHere</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview-of-the-functions">Overview of the functions:<a class="anchor" aria-label="anchor" href="#overview-of-the-functions"></a>
</h2>
<ul>
<li>
<code><a href="../reference/set_specieslink_credentials.html">set_specieslink_credentials()</a></code>: stores your SpeciesLink
API key in the R environment.</li>
<li>
<code><a href="../reference/set_gbif_credentials.html">set_gbif_credentials()</a></code>: stores your GBIF credentials
(username, email, and password) in the R environment.</li>
<li>
<code><a href="../reference/get_specieslink.html">get_specieslink()</a></code>: retrieves occurrence data from the
SpeciesLink network using user-defined filters.</li>
<li>
<code><a href="../reference/prepare_gbif_download.html">prepare_gbif_download()</a></code>: prepares the query data
required for a robust GBIF download request.</li>
<li>
<code><a href="../reference/request_gbif.html">request_gbif()</a></code>: submits an asynchronous request to
download occurrence data from GBIF.</li>
<li>
<code><a href="../reference/import_gbif.html">import_gbif()</a></code>: imports the dataset that has been
processed and downloaded from GBIF using the request key generated by
<code><a href="../reference/request_gbif.html">request_gbif()</a></code>.</li>
<li>
<code><a href="../reference/get_bien.html">get_bien()</a></code>: downloads occurrence records from the
Botanical Information and Ecology Network (BIEN) database.</li>
<li>
<code><a href="../reference/get_idigbio.html">get_idigbio()</a></code>: downloads species occurrence records
from the iDigBio (Integrated Digitized Biocollections) database.</li>
<li>
<code><a href="../reference/format_columns.html">format_columns()</a></code>: formats and standardizes column names
and data types of an occurrence dataset using a built-in template or a
custom metadata object.</li>
<li>
<code><a href="../reference/create_metadata.html">create_metadata()</a></code>: creates a custom metadata template
that maps the column names of an external (non-standard) dataset to the
package’s required standardized schema.</li>
<li>
<code><a href="../reference/bind_here.html">bind_here()</a></code>: combines multiple standardized occurrence
data frames into a single dataset.</li>
<li>
<code><a href="../reference/spatialize.html">spatialize()</a></code>: converts the unified occurrence data
frame into a SpatVector object.</li>
</ul>
</div>
<div class="section level2">
<h2 id="setting-up-credentials">Setting up credentials<a class="anchor" aria-label="anchor" href="#setting-up-credentials"></a>
</h2>
<p>Some databases require authentication to access their API. It is
recommended to configure this before starting your downloads.</p>
<div class="section level3">
<h3 id="gbif">GBIF<a class="anchor" aria-label="anchor" href="#gbif"></a>
</h3>
<p>To download data from <a href="https://www.gbif.org/" class="external-link">GBIF</a> using
the asynchronous API, you must have an account an store your credentials
(username, email, and password) in your R environment. You can find your
GBIF username and the e-mail address associated with your account on the
GBIF website (<a href="https://www.gbif.org/user/profile" class="external-link">https://www.gbif.org/user/profile</a>).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_gbif_credentials.html">set_gbif_credentials</a></span><span class="op">(</span></span>
<span>  gbif_username <span class="op">=</span> <span class="st">"your_username"</span>,</span>
<span>  gbif_email <span class="op">=</span> <span class="st">"your_email@domain.com"</span>,</span>
<span>  gbif_password <span class="op">=</span> <span class="st">"your_password"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specieslink">SpeciesLink<a class="anchor" aria-label="anchor" href="#specieslink"></a>
</h3>
<p>To retrieve records from the SpeciesLink network, an API key is
required. You can create and check your API key at: <a href="https://specieslink.net/aut/profile/apikeys" class="external-link">https://specieslink.net/aut/profile/apikeys</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/set_specieslink_credentials.html">set_specieslink_credentials</a></span><span class="op">(</span>specieslink_key <span class="op">=</span> <span class="st">"your_api_key"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<blockquote>
<p>Note: Only GBIF and SpeciesLink require credentials to be configured
beforehand. The BIEN and iDigBio databases do not require API
authentication for retrieving occurrence data.</p>
</blockquote>
</div>
</div>
<div class="section level2">
<h2 id="data-acquisition">Data acquisition<a class="anchor" aria-label="anchor" href="#data-acquisition"></a>
</h2>
<p>We will download occurrence data for <em>Araucaria angustifolia</em>
as an example.</p>
<div class="section level3">
<h3 id="gbif-1">GBIF<a class="anchor" aria-label="anchor" href="#gbif-1"></a>
</h3>
<p>To ensure access to large datasets, the GBIF download process is
split into three steps: prepare, request, and import.</p>
<p>To download record from GBIF, we need to define a directory to save
the files.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Store downloads in a temporary directory</span></span>
<span><span class="co"># In your own project, replace this with a permanent directory</span></span>
<span><span class="va">output_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"occ_data"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="va">output_dir</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Prepare the taxonomic query</span></span>
<span><span class="va">gbif_prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_gbif_download.html">prepare_gbif_download</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Araucaria angustifolia"</span><span class="op">)</span></span></code></pre></div>
<p>The function returns a <code>data.frame</code> containing information
about the species in GBIF, including the total number of records, the
number of records with geographic coordinates (longitude and latitude),
the GBIF key (ID), and the taxonomic classification.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gbif_prep</span></span>
<span><span class="co">#&gt; with_coordinates n_records                species usageKey                          scientificName          canonicalName</span></span>
<span><span class="co">#&gt; 1             3056     15696 Araucaria angustifolia  2684940 Araucaria angustifolia (Bertol.) Kuntze Araucaria angustifolia</span></span>
<span><span class="co">#&gt;     rank   status confidence matchType kingdom       phylum   order        family     genus kingdomKey phylumKey classKey</span></span>
<span><span class="co">#&gt; 1 SPECIES ACCEPTED         97     EXACT Plantae Tracheophyta Pinales Araucariaceae Araucaria          6   7707728      194</span></span>
<span><span class="co">#&gt;   orderKey familyKey genusKey speciesKey     class          verbatim_name</span></span>
<span><span class="co">#&gt; 1      640      3924  2684910    2684940 Pinopsida Araucaria angustifolia</span></span></code></pre></div>
<p>After confirming that the information is correct and that this is
indeed the species for which we want to download records, we can use
this object to request a download from GBIF. By default, the function
retrieves only records with geographic coordinates and without spatial
issues, but this can be modified.</p>
<p>The function also supports more complex download requests by allowing
predicates to be passed via the <code>additional_predicates</code>
argument. See <code>help(rgbif::pred)</code> for more details.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Submit the request to GBIF</span></span>
<span><span class="va">gbif_req</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/request_gbif.html">request_gbif</a></span><span class="op">(</span></span>
<span>  gbif_info <span class="op">=</span> <span class="va">gbif_prep</span>,</span>
<span>  hasCoordinate <span class="op">=</span> <span class="cn">TRUE</span>,      <span class="co"># Retrieve only records with coordinates</span></span>
<span>  hasGeospatialIssue <span class="op">=</span> <span class="cn">FALSE</span> <span class="co"># Exclude records with geospatial issues</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The request is processed by GBIF and may take several minutes to
complete (usually less than 15 minutes, but potentially several hours
depending on the number of occurrences). You can check the status of the
download using the <code>rgbif</code> package. Once the process is
complete, the following message is returned:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_wait.html" class="external-link">occ_download_wait</a></span><span class="op">(</span><span class="va">gbif_req</span><span class="op">)</span></span>
<span><span class="co">#&gt; status: succeeded</span></span>
<span><span class="co">#&gt; download is done, status: succeeded</span></span></code></pre></div>
<p>Now we can download the occurrence records and import them into
R:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import the processed file</span></span>
<span><span class="va">occ_gbif</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/import_gbif.html">import_gbif</a></span><span class="op">(</span>request_key <span class="op">=</span> <span class="va">gbif_req</span><span class="op">)</span></span>
<span><span class="co">#&gt; Download file size: 2.04 MB</span></span></code></pre></div>
<p>By default, the function imports the dataset with only the 25 columns
required by the other functions in the package. This behavior can be
changed by setting <code>select_columns = FALSE</code> or by explicitly
specifying the columns to import via the <code>columns_to_import</code>
argument.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">occ_gbif</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 6 × 25</span></span>
<span><span class="co">#&gt;   scientificName                acceptedScientificName occurrenceID collectionCode catalogNumber decimalLongitude #&gt; decimalLatitude</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;                         &lt;chr&gt;                  &lt;chr&gt;        &lt;chr&gt;          &lt;chr&gt;                    &lt;dbl&gt;           #&gt; &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 Araucaria angustifolia (Bert… Araucaria angustifoli… urn:catalog… ALTA-VP        74703                    -52.8          #&gt; -26.4 </span></span>
<span><span class="co">#&gt; 2 Araucaria angustifolia (Bert… Araucaria angustifoli… https://www… Observations   329390275                -49.2          #&gt; -25.4 </span></span>
<span><span class="co">#&gt; 3 Araucaria angustifolia (Bert… Araucaria angustifoli… https://www… Observations   329483122                -49.5          #&gt; -28.0 </span></span>
<span><span class="co">#&gt; 4 Araucaria angustifolia (Bert… Araucaria angustifoli… https://www… Observations   329455309                -74.0            #&gt; 4.68</span></span>
<span><span class="co">#&gt; 5 Araucaria angustifolia (Bert… Araucaria angustifoli… https://www… Observations   329576016                -45.6          #&gt; -22.7 </span></span>
<span><span class="co">#&gt; 6 Araucaria angustifolia (Bert… Araucaria angustifoli… https://www… Observations   329805643                175.           #&gt; -39.9 </span></span>
<span><span class="co">#&gt; # ℹ 18 more variables: coordinateUncertaintyInMeters &lt;dbl&gt;, elevation &lt;dbl&gt;, continent &lt;chr&gt;, countryCode &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   stateProvince &lt;chr&gt;, municipality &lt;chr&gt;, locality &lt;chr&gt;, verbatimLocality &lt;chr&gt;, year &lt;int&gt;, eventDate &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   recordedBy &lt;chr&gt;, identifiedBy &lt;chr&gt;, basisOfRecord &lt;chr&gt;, occurrenceRemarks &lt;chr&gt;, habitat &lt;chr&gt;, datasetName &lt;chr&gt;,</span></span>
<span><span class="co">#&gt; #   datasetKey &lt;chr&gt;, speciesKey &lt;int&gt;</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="specieslink-bien-and-idigbio">SpeciesLink, BIEN, and iDigBio<a class="anchor" aria-label="anchor" href="#specieslink-bien-and-idigbio"></a>
</h3>
<p>GBIF is the most used database for obtaining occurrence records.
However, unique records can be found in other databases. In the RuHere
package, we implement functions for downloading records from 3 other
databases:</p>
<ul>
<li>SpeciesLink: a large-scale biodiversity information portal created
in Brazil. Most of the records found in <a href="https://specieslink.net/" class="external-link">SpeciesLink</a> are also found in GBIF,
but it also provide unique records.</li>
<li>BIEN: occurrence records cleaned and standardized by the <a href="https://bien.nceas.ucsb.edu/bien/" class="external-link">Botanical Information and
Ecology Network</a>.</li>
<li>iDigBio: occurrence records cleaned and standardized by the <a href="https://www.idigbio.org/" class="external-link">Integrated Digitized Biocollections
project</a>.</li>
</ul>
<p>These databases allow direct downloading through a single function
call.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SpeciesLink: Filtering by Species</span></span>
<span><span class="va">occ_sl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_specieslink.html">get_specieslink</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Araucaria angustifolia"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># BIEN: Natives only, excluding cultivated records</span></span>
<span><span class="va">occ_bien</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_bien.html">get_bien</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Araucaria angustifolia"</span>,</span>
<span>                     cultivated <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                     natives.only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Getting page 1 of records</span></span>
<span></span>
<span><span class="co"># iDigBio: </span></span>
<span><span class="va">occ_idig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_idigbio.html">get_idigbio</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Araucaria angustifolia"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="standardization-and-unification">Standardization and unification<a class="anchor" aria-label="anchor" href="#standardization-and-unification"></a>
</h2>
<p>At this stage, we have four occurrence datasets
(<code>occ_gbif</code>, <code>occ_sl</code>, <code>occ_bien</code>, and
<code>occ_idig</code>). We can merge these datasets using the
bind_here() function. However, we get an error if we try to merge the
raw datasets:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bind_here.html">bind_here</a></span><span class="op">(</span><span class="va">occ_gbif</span>, <span class="va">occ_sl</span>, <span class="va">occ_bien</span>, <span class="va">occ_idig</span><span class="op">)</span></span>
<span><span class="co">#&gt; Error: All datasets must have the same columns.</span></span></code></pre></div>
<p>This occurs because each data source may provide datasets with
different column names (e.g., <code>decimalLongitude</code>
vs. <code>longitude</code> vs. <code>long</code>). Another common issue
involves column classes. For instance, date-related fields (such as
collection dates) may be stored as character vectors, numeric values, or
objects of class <code>Date</code>. Special characters can also cause
problems, as datasets with different text encodings may fail to bind
correctly.</p>
<p>All of these issues can be addressed using the
<code><a href="../reference/format_columns.html">format_columns()</a></code> function. This function applies metadata
templates to standardize column names and data types, ensuring that all
datasets are consistent and can be safely combined.</p>
<div class="section level3">
<h3 id="standardizing-columns-format_columns">Standardizing columns (<code>format_columns</code>)<a class="anchor" aria-label="anchor" href="#standardizing-columns-format_columns"></a>
</h3>
<p>We apply the function to each dataset, specifying the source in the
<code>metadata</code> argument. This standardizes column names, extracts
clean binomials, and fixes data types.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Standardizing GBIF</span></span>
<span><span class="va">gbif_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_columns.html">format_columns</a></span><span class="op">(</span><span class="va">occ_gbif</span>, metadata <span class="op">=</span> <span class="st">"gbif"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standardizing SpeciesLink (checking for encoding issues)</span></span>
<span><span class="va">sl_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_columns.html">format_columns</a></span><span class="op">(</span><span class="va">occ_sl</span>, metadata <span class="op">=</span> <span class="st">"specieslink"</span>, check_encoding <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: NAs introduced by coercion&gt; </span></span>
<span></span>
<span><span class="co"># Standardizing BIEN</span></span>
<span><span class="va">bien_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_columns.html">format_columns</a></span><span class="op">(</span><span class="va">occ_bien</span>, metadata <span class="op">=</span> <span class="st">"bien"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Standardizing iDigBio</span></span>
<span><span class="va">idig_std</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_columns.html">format_columns</a></span><span class="op">(</span><span class="va">occ_idig</span>, metadata <span class="op">=</span> <span class="st">"idigbio"</span><span class="op">)</span></span></code></pre></div>
<p>You may sometimes encounter the warning
<code>“NAs introduced by coercion”</code>. This occurs when a column
that is expected to store numeric values (for example, a year) contains
data of another class (such as character strings) that cannot be
converted to numeric. In such cases, the incompatible values are
replaced with <code>NA</code>.</p>
<p>Now, we can safelly bind the occurrences:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">all_occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bind_here.html">bind_here</a></span><span class="op">(</span><span class="va">gbif_std</span>, <span class="va">sl_std</span>, <span class="va">bien_std</span>, <span class="va">idig_std</span><span class="op">)</span></span>
<span><span class="co"># Number of records by database</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">all_occ</span><span class="op">$</span><span class="va">data_source</span><span class="op">)</span></span>
<span><span class="co">#&gt;       bien        gbif     idigbio specieslink </span></span>
<span><span class="co">#&gt;        137        3000        1271        1224 </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="customizing-metadata-create_metadata">Customizing Metadata (<code>create_metadata</code>)<a class="anchor" aria-label="anchor" href="#customizing-metadata-create_metadata"></a>
</h3>
<p>The functions above automatically standardize your data because the
package contains internal metadata templates (“presets”) for GBIF,
SpeciesLink, BIEN, and iDigBio. However, if you import occurrence data
from an external source (e.g., a local CSV file) with different column
names, you must first create a metadata template using
<code><a href="../reference/create_metadata.html">create_metadata()</a></code>. This maps your original column names to
the package’s standardized schema.</p>
<p>The following example demonstrates how to handle data from an
external source, using occurrences of cougar (<em>Puma concolor</em>)
originally from the <code>atlanticr</code> R package (which is included
in <code>RuHere</code> for demonstration purposes).</p>
<p>In summary, the arguments must be filled with the names of the
columns in the occurrence dataset that are equivalent to the expected
fields. For example, in the example dataset, the
<code>scientificName</code> is stored in the
<code>"actual_species_name"</code> column, and the coordinates are
stored in the <code>"longitude"</code> and <code>"latitude"</code>
columns. These three columns are the only mandatory ones, but we
strongly recommend providing as many additional columns as possible in
order to take full advantage of the other functions in the package.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Import data example</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"puma_atlanticr"</span>, package <span class="op">=</span> <span class="st">"RuHere"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create metadata to standardize the occurrences</span></span>
<span><span class="va">puma_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_metadata.html">create_metadata</a></span><span class="op">(</span>occ <span class="op">=</span> <span class="va">puma_atlanticr</span>,</span>
<span>                                 scientificName <span class="op">=</span> <span class="st">"actual_species_name"</span>,</span>
<span>                                 decimalLongitude <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>                                 decimalLatitude <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>                                 elevation <span class="op">=</span> <span class="st">"altitude"</span>,</span>
<span>                                 country <span class="op">=</span> <span class="st">"country"</span>,</span>
<span>                                 stateProvince <span class="op">=</span> <span class="st">"state"</span>,</span>
<span>                                 municipality <span class="op">=</span> <span class="st">"municipality"</span>,</span>
<span>                                 locality <span class="op">=</span> <span class="st">"study_location"</span>,</span>
<span>                                 year <span class="op">=</span> <span class="st">"year_finish"</span>,</span>
<span>                                 habitat <span class="op">=</span> <span class="st">"vegetation_type"</span>,</span>
<span>                                 datasetName <span class="op">=</span> <span class="st">"reference"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Now, we can use this metadata to standardize the columns</span></span>
<span><span class="va">puma_occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/format_columns.html">format_columns</a></span><span class="op">(</span>occ <span class="op">=</span> <span class="va">puma_atlanticr</span>, metadata <span class="op">=</span> <span class="va">puma_metadata</span>,</span>
<span>                           binomial_from <span class="op">=</span> <span class="st">"actual_species_name"</span>,</span>
<span>                           data_source <span class="op">=</span> <span class="st">"atlanticr"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/headtail.html" class="external-link">head</a></span><span class="op">(</span><span class="va">puma_occ</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;     record_id       species scientificName collectionCode catalogNumber</span></span>
<span><span class="co">#&gt; 1 atlanticr_1 Puma concolor  Puma concolor           &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2 atlanticr_2 Puma concolor  Puma concolor           &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3 atlanticr_3 Puma concolor  Puma concolor           &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4 atlanticr_4 Puma concolor  Puma concolor           &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5 atlanticr_5 Puma concolor  Puma concolor           &lt;NA&gt;          &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6 atlanticr_6 Puma concolor  Puma concolor           &lt;NA&gt;          &lt;NA&gt;</span></span></code></pre></div>
<p>Even though this is an occurrence dataset from a different species,
we can merge the cougar occurrences with those of Araucaria:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">occ_araucaria_cougar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bind_here.html">bind_here</a></span><span class="op">(</span><span class="va">all_occ</span>, <span class="co">#Occurrences of Araucaria</span></span>
<span>                                  <span class="va">puma_occ</span><span class="op">)</span> <span class="co">#Occurrences of cougar</span></span>
<span><span class="co"># Number of records per species</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">occ_araucaria_cougar</span><span class="op">$</span><span class="va">species</span><span class="op">)</span></span>
<span><span class="co">#&gt; Araucaria angustifolia          Puma concolor </span></span>
<span><span class="co">#&gt;                  5632                    139 </span></span></code></pre></div>
<p>The result is a robust dataset containing essential standardized
columns such as species, decimalLongitude, decimalLatitude, and
year.</p>
</div>
</div>
<div class="section level2">
<h2 id="spatialization-spatialize">Spatialization (<code>spatialize</code>)<a class="anchor" aria-label="anchor" href="#spatialization-spatialize"></a>
</h2>
<p>To visualize the data on a map or perform geospatial operations, we
can convert the data frame into a <code>SpatVector</code> object. This
object can be plotted using the <strong>terra</strong> package
(<code><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">terra::plot</a></code>) or displayed in an interactive map using the
<strong>mapview</strong> package:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to spatial object</span></span>
<span><span class="va">occ_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/spatialize.html">spatialize</a></span><span class="op">(</span>occ <span class="op">=</span> <span class="va">occ_araucaria_cougar</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load mapview</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-spatial/mapview" class="external-link">mapview</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the distribution using mapview</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/mapview/reference/mapView.html" class="external-link">mapview</a></span><span class="op">(</span><span class="va">occ_spatial</span>, zcol <span class="op">=</span> <span class="st">"species"</span>, layer.name <span class="op">=</span> <span class="st">"Species"</span>, cex <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="vignettes_img/IMG01.jpeg" class="r-plt" alt="" width="80%" style="display: block; margin: auto;"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weverton C. F. Trindade, Fernanda S. Caron.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
