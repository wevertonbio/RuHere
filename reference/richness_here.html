<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Species Richness and Occurrence Summary Mapping — richness_here • RuHere</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Species Richness and Occurrence Summary Mapping — richness_here"><meta name="description" content="This function generates spatial grids (rasters) of species richness,
record density, or summarized biological traits from occurrence data.
It supports custom resolutions, masking, and automatic coordinate
reprojection to match reference rasters."><meta property="og:description" content="This function generates spatial grids (rasters) of species richness,
record density, or summarized biological traits from occurrence data.
It supports custom resolutions, masking, and automatic coordinate
reprojection to match reference rasters."><meta property="og:image" content="https://wevertonbio.github.io/RuHere/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RuHere</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-code"></span> Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/obtaining_data.html">1. Obtaining and preparing occurrence data</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_consistency.html">2. Ensuring spatial consistency</a></li>
    <li><a class="dropdown-item" href="../articles/flagging_records.html">3. Flagging Records Using Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/flagging_records_species_list.html">4. Flagging Records with Specialists' Information</a></li>
    <li><a class="dropdown-item" href="../articles/sampling_bias.html">5. Reducing sampling bias</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wevertonbio/RuHere/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Species Richness and Occurrence Summary Mapping</h1>
      <small class="dont-index">Source: <a href="https://github.com/wevertonbio/RuHere/blob/main/R/richness_here.R" class="external-link"><code>R/richness_here.R</code></a></small>
      <div class="d-none name"><code>richness_here.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function generates spatial grids (rasters) of species richness,
record density, or summarized biological traits from occurrence data.
It supports custom resolutions, masking, and automatic coordinate
reprojection to match reference rasters.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">richness_here</span><span class="op">(</span></span>
<span>  <span class="va">occ</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  long <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  records <span class="op">=</span> <span class="st">"record_id"</span>,</span>
<span>  raster_base <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  res <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"epsg:4326"</span>,</span>
<span>  mask <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  summary <span class="op">=</span> <span class="st">"records"</span>,</span>
<span>  field <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  fun <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-occ">occ<a class="anchor" aria-label="anchor" href="#arg-occ"></a></dt>
<dd><p>(data.frame) a dataset containing occurrence records. Must
include columns for species names and geographic coordinates.</p></dd>


<dt id="arg-species">species<a class="anchor" aria-label="anchor" href="#arg-species"></a></dt>
<dd><p>(character) the name of the column in <code>occ</code> that contains the
species scientific names. Default is <code>"species"</code>.</p></dd>


<dt id="arg-long">long<a class="anchor" aria-label="anchor" href="#arg-long"></a></dt>
<dd><p>(character) the name of the column in <code>occ</code> that contains the
longitude values. Default is <code>"decimalLongitude"</code>.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>(character) the name of the column in <code>occ</code> that contains the
latitude values. Default is <code>"decimalLatitude"</code>.</p></dd>


<dt id="arg-records">records<a class="anchor" aria-label="anchor" href="#arg-records"></a></dt>
<dd><p>(character) the name of the column in <code>occ</code> that contains the
record names. Default is <code>"record_id"</code>.</p></dd>


<dt id="arg-raster-base">raster_base<a class="anchor" aria-label="anchor" href="#arg-raster-base"></a></dt>
<dd><p>(SpatRaster) an optional reference raster. If provided,
the output will match its resolution, extent, and CRS. Default is <code>NULL</code>.</p></dd>


<dt id="arg-res">res<a class="anchor" aria-label="anchor" href="#arg-res"></a></dt>
<dd><p>(numeric) the desired resolution (in decimal degrees if WGS84)
for the output grid. Only used if <code>raster_base</code> is <code>NULL</code>.</p></dd>


<dt id="arg-crs">crs<a class="anchor" aria-label="anchor" href="#arg-crs"></a></dt>
<dd><p>(character) the coordinate reference system of the raster.
(see ?terra::crs). Default is "epsg:4326". Only applicable if <code>raster_base</code>
is not provided.</p></dd>


<dt id="arg-mask">mask<a class="anchor" aria-label="anchor" href="#arg-mask"></a></dt>
<dd><p>(SpatRaster or SpatVector) an optional layer to mask the
final output. Default is <code>NULL</code>.</p></dd>


<dt id="arg-summary">summary<a class="anchor" aria-label="anchor" href="#arg-summary"></a></dt>
<dd><p>(character) the type of summary to calculate.
Either <code>"records"</code> (number of occurrences per cell) or <code>"species"</code>
(number of unique species per cell). Default is <code>"records"</code>.</p></dd>


<dt id="arg-field">field<a class="anchor" aria-label="anchor" href="#arg-field"></a></dt>
<dd><p>(character or named vector) columns in <code>occ</code> to summarize
(e.g., traits). If a named vector is provided, names must match species
in <code>occ</code>. Used to summarize traits or flags in both 'species' and 'records'
modes. Default is <code>NULL</code>.</p></dd>


<dt id="arg-fun">fun<a class="anchor" aria-label="anchor" href="#arg-fun"></a></dt>
<dd><p>(function) the function to aggregate <code>field</code> values
(e.g., <code>mean</code>, <code>max</code>, <code>sum</code>). Default is <code>mean</code>.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>(logical) whether to print messages about the progress.
Default is <code>TRUE</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>SpatRaster</code> object representing the calculated richness,
density, or trait summary.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"occ_flagged"</span>, package <span class="op">=</span> <span class="st">"RuHere"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Mapping the density of records</span></span></span>
<span class="r-in"><span><span class="va">r_density</span> <span class="op">&lt;-</span> <span class="fu">richness_here</span><span class="op">(</span><span class="va">occ_flagged</span>, summary <span class="op">=</span> <span class="st">"records"</span>, res <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ggrid_here.html">ggrid_here</a></span><span class="op">(</span><span class="va">r_density</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="richness_here-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># We can also summarize key features:</span></span></span>
<span class="r-in"><span><span class="co"># 1. Identifying problematic regions by summing error flags</span></span></span>
<span class="r-in"><span><span class="co"># We create a variable to store the sum of logical flags (TRUE = 1, FALSE = 0)</span></span></span>
<span class="r-in"><span><span class="va">total_flags</span> <span class="op">&lt;-</span> <span class="va">occ_flagged</span><span class="op">$</span><span class="va">florabr_flag</span> <span class="op">+</span></span></span>
<span class="r-in"><span>               <span class="va">occ_flagged</span><span class="op">$</span><span class="va">wcvp_flag</span> <span class="op">+</span></span></span>
<span class="r-in"><span>               <span class="va">occ_flagged</span><span class="op">$</span><span class="va">iucn_flag</span> <span class="op">+</span></span></span>
<span class="r-in"><span>               <span class="va">occ_flagged</span><span class="op">$</span><span class="va">cultivated_flag</span> <span class="op">+</span></span></span>
<span class="r-in"><span>               <span class="va">occ_flagged</span><span class="op">$</span><span class="va">inaturalist_flag</span> <span class="op">+</span></span></span>
<span class="r-in"><span>               <span class="va">occ_flagged</span><span class="op">$</span><span class="va">duplicated_flag</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">total_flags</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">occ_flagged</span><span class="op">$</span><span class="va">record_id</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using summary = "records" with to see the average accumulation of errors</span></span></span>
<span class="r-in"><span><span class="co"># with fun = mean to see the average accumulation</span></span></span>
<span class="r-in"><span><span class="va">r_flags</span> <span class="op">&lt;-</span> <span class="fu">richness_here</span><span class="op">(</span><span class="va">occ_flagged</span>, summary <span class="op">=</span> <span class="st">"records"</span>,</span></span>
<span class="r-in"><span>                         field <span class="op">=</span> <span class="va">total_flags</span>,</span></span>
<span class="r-in"><span>                         fun <span class="op">=</span> <span class="va">mean</span>, res <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ggrid_here.html">ggrid_here</a></span><span class="op">(</span><span class="va">r_flags</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="richness_here-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 2. Or we can summarize organisms traits spatially</span></span></span>
<span class="r-in"><span><span class="co"># Simulating a trait (e.g., mass) for each unique record</span></span></span>
<span class="r-in"><span><span class="va">spp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">occ_flagged</span><span class="op">$</span><span class="va">record_id</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sim_mass</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">spp</span><span class="op">)</span>, <span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span>, <span class="va">spp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">r_trait</span> <span class="op">&lt;-</span> <span class="fu">richness_here</span><span class="op">(</span><span class="va">occ_flagged</span>, summary <span class="op">=</span> <span class="st">"records"</span>,</span></span>
<span class="r-in"><span>                         field <span class="op">=</span> <span class="va">sim_mass</span>, fun <span class="op">=</span> <span class="va">mean</span>, res <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ggrid_here.html">ggrid_here</a></span><span class="op">(</span><span class="va">r_trait</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="richness_here-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weverton C. F. Trindade, Fernanda S. Caron.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

