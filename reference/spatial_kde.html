<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Kernel Density Estimation (Heatmap) for occurrence data — spatial_kde • RuHere</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Kernel Density Estimation (Heatmap) for occurrence data — spatial_kde"><meta name="description" content='This function creates density heatmaps using kernel density estimation.
The algorithm is inspired by the SpatialKDE R package and the "Heatmap"
tool from QGIS.
Each occurrence contributes to the density surface within a circular
neighborhood defined by a specified radius.'><meta property="og:description" content='This function creates density heatmaps using kernel density estimation.
The algorithm is inspired by the SpatialKDE R package and the "Heatmap"
tool from QGIS.
Each occurrence contributes to the density surface within a circular
neighborhood defined by a specified radius.'><meta property="og:image" content="https://wevertonbio.github.io/RuHere/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">RuHere</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa fas fa-code"></span> Functions</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book"></span> Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/obtaining_data.html">1. Obtaining and preparing occurrence data</a></li>
    <li><a class="dropdown-item" href="../articles/spatial_consistency.html">2. Ensuring spatial consistency</a></li>
    <li><a class="dropdown-item" href="../articles/flagging_records.html">3. Flagging Records Using Metadata</a></li>
    <li><a class="dropdown-item" href="../articles/flagging_records_species_list.html">4. Flagging Records with Specialists' Information</a></li>
    <li><a class="dropdown-item" href="../articles/sampling_bias.html">5. Reducing sampling bias</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/wevertonbio/RuHere/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Kernel Density Estimation (Heatmap) for occurrence data</h1>
      <small class="dont-index">Source: <a href="https://github.com/wevertonbio/RuHere/blob/main/R/spatial_kde.R" class="external-link"><code>R/spatial_kde.R</code></a></small>
      <div class="d-none name"><code>spatial_kde.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function creates density heatmaps using kernel density estimation.
The algorithm is inspired by the <strong>SpatialKDE</strong> R package and the "Heatmap"
tool from QGIS.
Each occurrence contributes to the density surface within a circular
neighborhood defined by a specified radius.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spatial_kde</span><span class="op">(</span></span>
<span>  <span class="va">occ</span>,</span>
<span>  long <span class="op">=</span> <span class="st">"decimalLongitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>  radius <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  resolution <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  buffer_extent <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"epsg:4326"</span>,</span>
<span>  raster_ref <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  kernel <span class="op">=</span> <span class="st">"quartic"</span>,</span>
<span>  scaled <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  decay <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  mask <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  zero_as_NA <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  weights <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-occ">occ<a class="anchor" aria-label="anchor" href="#arg-occ"></a></dt>
<dd><p>(data.frame, data.table, or SpatVector) a data frame or SpatVector containing the occurrences. Must contain columns longitude and latitude.</p></dd>


<dt id="arg-long">long<a class="anchor" aria-label="anchor" href="#arg-long"></a></dt>
<dd><p>(character) the name of the column in <code>occ</code> that contains the
longitude values. Default is <code>"decimalLongitude"</code>.</p></dd>


<dt id="arg-lat">lat<a class="anchor" aria-label="anchor" href="#arg-lat"></a></dt>
<dd><p>(character) the name of the column in <code>occ</code> that contains the
latitude values. Default is <code>"decimalLatitude"</code>.</p></dd>


<dt id="arg-radius">radius<a class="anchor" aria-label="anchor" href="#arg-radius"></a></dt>
<dd><p>(numeric) a positive numeric value specifying the smoothing
radius for the kernel density estimate. This parameter determines the
circular neighborhood around each point where that point will have an
influence. See details. Default is 0.2.</p></dd>


<dt id="arg-resolution">resolution<a class="anchor" aria-label="anchor" href="#arg-resolution"></a></dt>
<dd><p>(numeric) a positive numeric value specifying the resolution
(in degrees or meters, depending on the <code>crs</code> provided) of the resultant
raster heatmap. Required if <code>raster_ref</code> is not provided. Default is NULL.</p></dd>


<dt id="arg-buffer-extent">buffer_extent<a class="anchor" aria-label="anchor" href="#arg-buffer-extent"></a></dt>
<dd><p>(numeric) width of the buffer (in kilometers) to draw
around the occurrences to define the area for computing the heatmap. Default
is 500.</p></dd>


<dt id="arg-crs">crs<a class="anchor" aria-label="anchor" href="#arg-crs"></a></dt>
<dd><p>(character) the coordinate reference system of the raster heatmap
(see ?terra::crs). Default is "epsg:4326". Only applicable if <code>raster_ref</code>
is not provided.</p></dd>


<dt id="arg-raster-ref">raster_ref<a class="anchor" aria-label="anchor" href="#arg-raster-ref"></a></dt>
<dd><p>(SpatRaster) an optional  raster to use as reference for
resolution, CRS, and extent. Default is NULL.</p></dd>


<dt id="arg-kernel">kernel<a class="anchor" aria-label="anchor" href="#arg-kernel"></a></dt>
<dd><p>(character) type of kernel to use. Available kernerls are
"uniform", "quartic", "triweight", "epanechnikov", or "triangular". Default
is "quartic".</p></dd>


<dt id="arg-scaled">scaled<a class="anchor" aria-label="anchor" href="#arg-scaled"></a></dt>
<dd><p>(logical) whether to scale output values to vary between 0 and</p><ol><li><p>Default is TRUE.</p></li>
</ol></dd>


<dt id="arg-decay">decay<a class="anchor" aria-label="anchor" href="#arg-decay"></a></dt>
<dd><p>(numeric) decay parameter for "triangular" kernel. Only
applicable if <code>kernel = triangular</code>.</p></dd>


<dt id="arg-mask">mask<a class="anchor" aria-label="anchor" href="#arg-mask"></a></dt>
<dd><p>(SpatRaster or SpatExtent) optional spatial object to define the
extent of the area for the heatmap. Default is NULL, in which case the
extent is derived from <code>raster_ref</code> (if provided) or from the convex hull of
occurrences plus <code>buffer_extent</code>.</p></dd>


<dt id="arg-zero-as-na">zero_as_NA<a class="anchor" aria-label="anchor" href="#arg-zero-as-na"></a></dt>
<dd><p>(logical) whether to convert regions with value 0 to NA.
Default is FALSE.</p></dd>


<dt id="arg-weights">weights<a class="anchor" aria-label="anchor" href="#arg-weights"></a></dt>
<dd><p>(numeric) optional vector of weights for individual points.
Must be the same length as the number of occurrences in <code>occ</code>. Default is
NULL.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A SpatRaster containing the kernel density values.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The <code>radius</code> parameter controls how far the influence of each observation
extends. Smaller values produce fine-grained peaks; larger values produce
smoother, more spread-out heatmaps. Units depend on the CRS: degrees for
geographic coordinates (default), meters for projected coordinates.</p>
<p>If <code>raster_ref</code> is not provided, the extent is calculated from the convex
hull of <code>occ</code> plus <code>buffer_extent</code>.</p>
<p>Kernels define the weight decay of points:
"uniform" = constant, "quartic"/"triweight"/"epanechnikov" = smooth, and
"triangular" = linear decay (using <code>decay</code> parameter).</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Hart, T., &amp; Zandbergen, P. (2014). Kernel density estimation and hotspot
mapping: Examining the influence of interpolation method, grid cell size,
and radius on crime forecasting. <strong>Policing: An International Journal of</strong>
<strong>Police Strategies &amp; Management</strong>, 37(2), 305-323.</p></li>
<li><p>Nelson, T. A., &amp; Boots, B. (2008). Detecting spatial hot spots in landscape
ecology. <strong>Ecography</strong>, 31(5), 556-566.</p></li>
<li><p>Chainey, S., Tompson, L., &amp; Uhlig, S. (2008). The utility of hotspot mapping
for predicting spatial patterns of crime. <strong>Security journal</strong>, 21(1), 4-28.</p></li>
<li><p>Caha J (2023). SpatialKDE: Kernel Density Estimation for Spatial Data.
<strong>https://jancaha.github.io/SpatialKDE/index.html</strong>.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Load example data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"occ_flagged"</span>, package <span class="op">=</span> <span class="st">"RuHere"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Remove flagged records</span></span></span>
<span class="r-in"><span><span class="va">occ</span> <span class="op">&lt;-</span> <span class="fu"><a href="remove_flagged.html">remove_flagged</a></span><span class="op">(</span><span class="va">occ_flagged</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Generate heatmap</span></span></span>
<span class="r-in"><span><span class="va">heatmap</span> <span class="op">&lt;-</span> <span class="fu">spatial_kde</span><span class="op">(</span>occ <span class="op">=</span> <span class="va">occ</span>, resolution <span class="op">=</span> <span class="fl">0.25</span>, buffer_extent <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>                       radius <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Plot heatmap with terra</span></span></span>
<span class="r-in"><span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">heatmap</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="spatial_kde-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co"># Plot heatmap with ggplot</span></span></span>
<span class="r-in"><span><span class="fu"><a href="ggmap_here.html">ggmap_here</a></span><span class="op">(</span>occ <span class="op">=</span> <span class="va">occ</span>, heatmap <span class="op">=</span> <span class="va">heatmap</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="spatial_kde-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Weverton C. F. Trindade, Fernanda S. Caron.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

